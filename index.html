<!DOCTYPE html>
<html lang="en">
    <head>
        <link rel="stylesheet" href="styles.css">
    </head>

    <body onload=init()>
        <div id="ikkuna">
            <canvas id="canvas">
              
            </canvas>
            <button id="plus" onclick=zoomIn()>+</button>  
            <button id="miinus" onclick=zoomOut()>-</button>

            <button id="up" onclick=panUp()>^</button>
            <button id="down" onclick=panDown()>v</button>
            <button id="left" onclick=panLeft()><</button>
            <button id="right" onclick=panRight()>></button>
        
        
        </div>

        <script>

            let screen_width = 1200
            let screen_height = 1200            

            let x_min = -2.0
            let x_max = 1.0
            let y_min = -1.5            
            let y_max = 1.5

            let panSpeed = 0.10
            let zoomSpeed = 0.10

            max_iterations = 100

            var canvas = document.getElementById('canvas')
            var ctx = canvas.getContext('2d')

            ctx.canvas.width = screen_width
            ctx.canvas.height = screen_height
            
            let imgdata = ctx.getImageData(0,0,screen_width, screen_height)
            let imgdatalength = imgdata.data.length

            function init() {
                
                let arr = []

                for (let j = 0; j < screen_height; j++) {
                    for (let i = 0; i < screen_width; i++){

                        c = {
                            x: mapPixel(i, x_min, x_max, screen_width),
                            y: mapPixel(j, y_min, y_max, screen_height)
                        }

                        let n = iterate(c)

                        if (n == max_iterations){
                            n = 0
                        }

                        imgdata.data[i*4 + j*screen_width*4] = (51 * n / max_iterations)                        
                        imgdata.data[i*4 + j*screen_width*4 + 1] = (155 * n / max_iterations)                        
                        imgdata.data[i*4 + j*screen_width*4 + 2] = (155 * n / max_iterations)                         
                        imgdata.data[i*4 + j*screen_width*4 + 3] = 255                        

                    }
                }
                ctx.putImageData(imgdata, 0, 0)
                console.log(x_min, x_max, y_min, y_max)
                
            }

            function iterate(c) {
                let z = { x: 0, y: 0 }, n = 0, div=0;

                while (n < max_iterations && div <= 2){
                
                    let z_squared = {
                        x: Math.pow(z.x, 2) - Math.pow(z.y, 2),
                        y: 2 * z.x * z.y
                        }                

                    z = {
                        x: z_squared.x + c.x,
                        y: z_squared.y + c.y
                    }

                    div = Math.sqrt(Math.pow(z.x, 2) + Math.pow(z.y, 2));
                    n += 1;
                }
                return n
            }

            function mapPixel(pixel, min, max, screen) {                
                return ((max - min) / screen * pixel) + min
            }         

            function zoomIn() {
                let x_scale = x_max - x_min
                let y_scale = y_max - y_min
                x_max -= x_scale * zoomSpeed
                x_min += x_scale * zoomSpeed
                y_max -= y_scale * zoomSpeed
                y_min += y_scale * zoomSpeed
                init()
            }

            function zoomOut() {
                let x_scale = x_max - x_min
                let y_scale = y_max - y_min
                x_max += x_scale * zoomSpeed
                x_min -= x_scale * zoomSpeed
                y_max += y_scale * zoomSpeed
                y_min -= y_scale * zoomSpeed
                init()
            }

            function panUp(){
                let y_scale = y_max - y_min
                y_max += y_scale * panSpeed
                y_min += y_scale * panSpeed
                init()
            }

            function panDown(){
                let y_scale = y_max - y_min
                y_max -= y_scale * panSpeed
                y_min -= y_scale * panSpeed
                init()
            }

            function panLeft(){
                let x_scale = x_max - x_min
                x_max += x_scale * panSpeed
                x_min += x_scale * panSpeed
                init()
            }

            function panRight(){
                let x_scale = x_max - x_min
                x_max -= x_scale * panSpeed
                x_min -= x_scale * panSpeed
                init()
            }

        </script>
    </body>
</html>